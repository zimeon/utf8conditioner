<html>
<head>
<title>Software - utf8conditioner</title>
</head>
<body>

<h1><code>utf8conditioner</code></h1>

<p>
This is a small C program that will either check or `fix' a UTF-8 byte stream.
It was designed to be used within an <a href="http://www.openarchives.org">OAI</a>
harvester to attempt to remove bad codes from supposedly UTF-8 byte streams so
that they can then be parsed using a standard XML parser which would otherwise
fail.
</p>
<p>
Without knowing why an illegal code is present in a supposedly UTF-8
byte stream, and thus what it should have been, it is impossible to properly 
correct an illegal UTF-8 byte stream.
However, experience has shown that some OAI server implementations which do not
use good XML writing libraries sometimes write byte streams which include codes 
from other character sets which make otherwise correctly structured XML responses 
unparsable. 
The <code>utf8conditioner</code> simply substitutes a dummy character or string 
(<code>?</code> by default) in place of bad byte sequences. This causes local 
corruption but usually allows the harvesting process to continue. Any harvester
should, of course, flag such errors to the operator and the operator should
report such errors to the data-provider so that they can be corrected.
</p>
<p>
This software is supplied under the GNU General Public License, 
see the file <code>COPYING</code> for details.
This software makes use of the routine <code>getopt.c</code> (included 
with the source) developed by the University of California, Berkeley 
and its contributors.
</p>

<h2>Download</h2>
<p>

<a href="utf8conditioner.tar.gz"><code>utf8conditioner.tar.gz</code></a> (14kB),
<a href="utf8conditioner.zip"<code>utf8conditioner.zip</code></a> (16kB).
</p>

<h2>Compiling and testing</h2>
<p>
This code was written and tested on an Intel-based Linux system using gcc. 
It is written in ANSI C and should compile on other platforms. I'd be 
interested to hear of problems/solutions for use on other platforms.
</p>
<ol>
<li>Unpack and change directory to location of source (unpacks in directory <tt>utf8</tt>)
<li>Edit the <code>Makefile</code> as necessary to set c compiler etc.
<li>Run <code>make</code>
<li>Executable is called <code>utf8conditioner</code>, it can be moved anywhere
  that is convenient.
<li>Run with <tt>-h</tt> flag to show options, e.g. <tt>./utf8conditioner -h</tt>.
</ol>

<h2>Use</h2>
<p>
Typical use for checking (<tt>-c</tt> flag) an XML file (<tt>-x</tt> flag for XML) is:
</p>
<pre>
cat utf8file | ./utf8conditioner -c -x
</pre>
<p>
Typical use for checking and `fixing' an XML file is:
</p>
<pre>
cat utf8file | ./utf8conditioner -x > fixedFile
</pre>
<p>
The way I use <code>utf8conditioner</code> for OAI harvesting is as follows:
</p>
<pre>
   Make OAI request to repository
   Attempt to parse response
   if (failed) {
     Pipe response through utf8conditioner (with -x flag)
     Attempt to parse conditioned response
     if (success) {
       Write warning message for operator
       Use conditioned response in place of original
     } else {
       Abort harvest
     }
   }
</pre>
<p>
You should, of course, report any problems in OAI response to the data-provider
so that they can be corrected. This utility simply aids debugging and makes it 
possible to complete the rest a harvest under certain error conditions.
</p>

<h2>Bugs</h2>
<p>
Please send bug reports to 
<a href="http://www.cs.cornell.edu/people/simeon">me</a> at
<a href="mailto:simeon@cs.cornell.edu"><code>simeon@cs.cornell.edu</code></a>.
</p>

<hr>
<address>
Simeon Warner
$Id: index.html,v 1.4 2003/01/22 15:50:05 simeon Exp $
</address>
</body>
</html>

